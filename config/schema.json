{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/universal-config.schema.json",
  "title": "Universal Config Schema",
  "description": "JSON Schema f√ºr die Validierung von Multi-Client Konfigurationen (Batterie, Maschinen, etc.)",
  "type": "object",
  "required": ["company", "workflow", "technical"],
  "properties": {
    "company": {
      "type": "object",
      "required": ["name", "brand", "domain", "country", "language", "currency", "crm_customer_id_prefix", "crm_sheet_id", "crm_sheet_tab", "contact", "google_drive"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "brand": { "type": "string", "minLength": 1 },
        "domain": { "type": "string", "format": "hostname" },
        "country": { "type": "string", "pattern": "^[A-Z]{2}$" },
        "language": { "type": "string", "pattern": "^[a-z]{2}$" },
        "currency": { "type": "string", "pattern": "^[A-Z]{3}$" },
        "crm_customer_id_prefix": { "type": "string" },
        "crm_sheet_id": { "type": "string" },
        "crm_sheet_tab": { "type": "string" },
        "timezone": { "type": "string" },
        "vat_id": { "type": "string" },
        "registration_number": { "type": "string" },
        "contact": {
          "type": "object",
          "required": ["support_email", "phone"],
          "properties": {
            "support_email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "sales_email": { "type": "string", "format": "email" },
            "technical_support": { "type": "string" }
          }
        },
        "google_drive": {
          "type": "object",
          "required": ["folder_id", "templates_folder"],
          "properties": {
            "folder_id": { "type": "string" },
            "templates_folder": { "type": "string" },
            "exports_folder": { "type": "string" },
            "archives_folder": { "type": "string" }
          }
        }
      }
    },
    "workflow": {
      "type": "object",
      "required": ["lead_id_prefix", "offer_id_prefix", "timezone", "ai", "api_keys", "crm_sync", "performance"],
      "properties": {
        "lead_id_prefix": { "type": "string" },
        "offer_id_prefix": { "type": "string" },
        "timezone": { "type": "string" },
        "ai": {
          "type": "object",
          "required": ["model", "temperature", "max_tokens"],
          "properties": {
            "model": { "type": "string" },
            "temperature": { "type": "number", "minimum": 0, "maximum": 2 },
            "max_tokens": { "type": "integer", "minimum": 1 },
            "fallback_model": { "type": "string" },
            "streaming": { "type": "boolean" }
          }
        },
        "api_keys": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "crm_sync": {
          "type": "object",
          "required": ["enabled", "method"],
          "properties": {
            "enabled": { "type": "boolean" },
            "method": {
              "type": "string",
              "enum": ["google_sheets", "airtable", "hubspot", "custom"]
            },
            "counter_tab": { "type": "string" },
            "sync_interval_minutes": { "type": "integer", "minimum": 1 },
            "batch_size": { "type": "integer", "minimum": 1 }
          }
        },
        "performance": {
          "type": "object",
          "required": ["scraper_timeout_ms", "max_items_per_run"],
          "properties": {
            "scraper_timeout_ms": { "type": "integer", "minimum": 1000 },
            "max_items_per_run": { "type": "integer", "minimum": 1 },
            "retry_attempts": { "type": "integer", "minimum": 0 },
            "backoff_multiplier": { "type": "number", "minimum": 1 },
            "max_concurrent_requests": { "type": "integer", "minimum": 1 }
          }
        }
      }
    },
    "technical": {
      "type": "object",
      "properties": {
        "battery_systems": {
          "type": "object",
          "properties": {
            "types": { "type": "array", "items": { "type": "string" } },
            "default_type": { "type": "string" },
            "efficiency": { "type": "number", "minimum": 0, "maximum": 1 },
            "usable_capacity_factor": { "type": "number", "minimum": 0, "maximum": 1 },
            "temperature_limits": {
              "type": "object",
              "required": ["min", "max"],
              "properties": {
                "min": { "type": "number" },
                "max": { "type": "number" }
              }
            },
            "voltage_range": {
              "type": "object",
              "required": ["min", "max"],
              "properties": {
                "min": { "type": "number" },
                "max": { "type": "number" }
              }
            },
            "cycle_life": {
              "type": "object",
              "additionalProperties": { "type": "integer", "minimum": 0 }
            },
            "safety_certifications": {
              "type": "array",
              "items": { "type": "string" }
            },
            "warranty_years": { "type": "integer", "minimum": 0 }
          }
        },
        "inverters": {
          "type": "object",
          "properties": {
            "default_efficiency": { "type": "number", "minimum": 0, "maximum": 1 },
            "max_ac_output_kw": { "type": "number", "minimum": 0 },
            "mppt_voltage_range": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            },
            "recommended_brands": {
              "type": "array",
              "items": { "type": "string" }
            },
            "grid_connection_types": {
              "type": "array",
              "items": { "type": "string" }
            },
            "protection_class": { "type": "string" }
          }
        },
        "pv_systems": {
          "type": "object",
          "properties": {
            "standard_yield_kwh_per_kwp": { "type": "number", "minimum": 0 },
            "roof_tilt_optimum_deg": { "type": "number", "minimum": 0, "maximum": 90 },
            "azimuth_optimum_deg": { "type": "number", "minimum": 0, "maximum": 360 },
            "default_safety_margin": { "type": "number", "minimum": 0, "maximum": 1 },
            "module_types": {
              "type": "array",
              "items": { "type": "string" }
            },
            "degradation_per_year": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "energy_design_rules": {
          "type": "object",
          "properties": {
            "max_battery_to_pv_ratio": { "type": "number", "minimum": 0 },
            "min_autarky_factor": { "type": "number", "minimum": 0, "maximum": 1 },
            "voltage_tolerance": { "type": "number", "minimum": 0, "maximum": 1 },
            "recommended_backup_time_hours": { "type": "number", "minimum": 0 },
            "max_string_length": { "type": "integer", "minimum": 1 },
            "min_distance_to_roof_edge_m": { "type": "number", "minimum": 0 }
          }
        },
        "machines": {
          "type": "object",
          "properties": {
            "default_voltage": { "type": "number", "minimum": 0 },
            "default_frequency": { "type": "number", "minimum": 0 },
            "default_air_pressure_bar": { "type": "number", "minimum": 0 },
            "motor_power_range_kw": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            },
            "max_conveyor_speed_m_per_min": { "type": "number", "minimum": 0 },
            "temperature_operating_range": {
              "type": "object",
              "required": ["min", "max"],
              "properties": {
                "min": { "type": "number" },
                "max": { "type": "number" }
              }
            },
            "ip_protection_min": { "type": "string", "pattern": "^IP[0-9]{2}$" },
            "noise_limit_db": { "type": "number", "minimum": 0 },
            "standard_safety_level": { "type": "string" },
            "recommended_brands": {
              "type": "array",
              "items": { "type": "string" }
            },
            "maintenance_interval_months": { "type": "integer", "minimum": 1 }
          }
        },
        "components": {
          "type": "object",
          "properties": {
            "sensor_types": {
              "type": "array",
              "items": { "type": "string" }
            },
            "default_safety_margin_percent": { "type": "number", "minimum": 0 },
            "material_options": {
              "type": "array",
              "items": { "type": "string" }
            },
            "actuator_types": {
              "type": "array",
              "items": { "type": "string" }
            },
            "controller_brands": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "machine_design_rules": {
          "type": "object",
          "properties": {
            "max_energy_consumption_kw": { "type": "number", "minimum": 0 },
            "target_efficiency_percent": { "type": "number", "minimum": 0, "maximum": 100 },
            "maintenance_interval_months": { "type": "integer", "minimum": 1 },
            "required_certifications": {
              "type": "array",
              "items": { "type": "string" }
            },
            "max_footprint_m2": { "type": "number", "minimum": 0 },
            "min_accessibility_clearance_m": { "type": "number", "minimum": 0 }
          }
        }
      },
      "additionalProperties": true
    },
    "metadata": {
      "type": "object",
      "properties": {
        "version": { "type": "string" },
        "last_updated": { "type": "string", "format": "date" },
        "updated_by": { "type": "string" },
        "environment": {
          "type": "string",
          "enum": ["production", "staging", "development"]
        }
      }
    }
  }
}
